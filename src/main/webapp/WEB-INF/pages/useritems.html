<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>项目介绍</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <link rel="stylesheet" href="//g.alicdn.com/msui/sm/0.6.2/css/sm.min.css">
    <link rel="stylesheet" href="//g.alicdn.com/msui/sm/0.6.2/css/sm-extend.min.css">
    <link rel="stylesheet" href="${request.contextPath}/css/img.css">
    <link rel="stylesheet" href="${request.contextPath}/css/main.css">
</head>
<body>
<div class="page-group">
    <div class="page page-current">
        <!-- 你的html代码 -->
        <header class="bar bar-nav">
            <a class="icon icon-left pull-left back"></a>
            <h1 class="title">详情</h1>
        </header>

        <input type="hidden" id="userId" value="${userId}">
        <div class="content">
            <div style="position: relative;text-align: center">
                <img id="headbackImg" style="width: 100%;height: 240px;"/>
                <div style="position:absolute;top:30%;left: 50%;margin-left: -50px;">
                    <div class="commentAvatarDiv">
                        <img class="commentAvatarImage" src="${request.contextPath}/images/default_head.jpg">
                    </div>
                    <div ><span id="nickNameSp" style="font-weight: bold;color: white;font-size: 22px;"></span></div>
                </div>
            </div>
            <div class="list-block cards-list" style="margin-top: 0px;">
                <ul id="items-card">

                </ul>
            </div>
            <div class="card">
                <div class="card-header">关于我</div>
                <div class="card-content">
                    <div class="card-content-inner">
                        <p id="userDesP"></p>
                    </div>
                </div>
            </div>


            <div class="card">
                <div class="card-header">Ta们的反馈:</div>
                <div class="card-content">
                    <div class="list-block media-list" id="feedbackDiv">

                    </div>
                </div>

            </div>


        </div>
    </div>
</div>

<script type='text/javascript' src='//g.alicdn.com/sj/lib/zepto/zepto.min.js' charset='utf-8'></script>
<script type='text/javascript' src='//g.alicdn.com/msui/sm/0.6.2/js/sm.min.js' charset='utf-8'></script>
<script type='text/javascript' src='//g.alicdn.com/msui/sm/0.6.2/js/sm-extend.min.js' charset='utf-8'></script>
<script>
    $.showIndicator();
    //背景图片
    var headPicArr = [1,2,3,4,5,6];
    var n = Math.floor(Math.random() * headPicArr.length + 1)-1;
    $('#headbackImg').attr('src','${request.contextPath}/images/headback'+headPicArr[n]+'.jpg');
    $.get('${request.contextPath}/user/get-user-items', {userId: $('#userId').val()}, function (response) {
        if(response){
            //$('#userShowPic').attr('src',response.imageObj.imageUrl);
            var userDes = response.description;
            if(userDes == '' || userDes == null){
                userDes = '暂无简介';
            }
            $('#userDesP').text(userDes);

            $('.commentAvatarImage').attr("src",response.imageObj.imageUrl);
            $('#nickNameSp').text(response.nickName);
            $.each(response.userItemList, function(i, item){

                var itemType = '';
                if(item.itemType == 'tel'){
                    itemType = '电话直连';
                }else if(item.itemType == 'meet'){
                    itemType = '直约面对面';
                }
                var descStr = item.description;
                if(descStr.length > 50){
                    descStr = descStr.substring(0,50)+'...';
                }
                var html = '<li class="card" onclick="toView(\''+item.itemId+'\',\''+item.userId+'\')">'+
                        '<div class="card-header"><span id="itemTypeSp">'+itemType+'</span></div>'+
                        '<div class="card-content">'+
                        '<div class="content-padded">'+
                        '<div class="row">'+
                        '<div class="col-80">'+item.price+'元/次（'+item.duration+'分钟）</div>'+
                        '<div class="col-20">'+item.score+'分</div>'+
                        '</div>'+
                        '<div class="row">'+
                        '<div class="col-100"><h1>'+item.title+'</h1></div>'+
                        '</div>'+
                        '</div>'+
                        '<div class="card-content-inner" id="descriptionDiv">'+descStr+'</div>'+
                        '</div>'+
                        '<div class="card-footer" id="useCountSp">已约'+item.useCount+'次</div>'+
                    '</li>';
                $('#items-card').append(html);
            });
            $.hideIndicator();
        }
    });

    $.get('${request.contextPath}/feedback/list-by-touser', {toUserId: $('#userId').val()}, function (response) {
        if(response){
            $.each(response, function(i, item){
                var optTime = item.optTime;
                if(optTime != null){
                    optTime = optTime.substring(0,10);
                }
                var html = '<ul>'+
                        '<li class="item-content">'+
                        '<div class="item-inner">'+
                        '<div class="item-title-row">'+
                        '<div class="item-title">'+item.createUserName+'</div>'+
                        '<div class="item-after">'+optTime+'</div>'+
                        '</div>'+
                        '<div class="item-subtitle">'+item.content+'</div>'+
                        '</div>'+
                        '</li>'+
                        '</ul>';
                $('#feedbackDiv').append(html);
            });

        }
    });
    function toView(itemId,userId){
        window.location.href = "${request.contextPath}/item/to-view/"+itemId;
    }
</script>
</body>
</html>