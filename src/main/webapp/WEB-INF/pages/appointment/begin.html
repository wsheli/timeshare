<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>预约</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <link rel="stylesheet" href="//g.alicdn.com/msui/sm/0.6.2/css/sm.min.css">
    <link rel="stylesheet" href="//g.alicdn.com/msui/sm/0.6.2/css/sm-extend.min.css">
    <style>
        .commentAvatarDiv{
            width: 50px;
            height: 50px;
            padding:0px;
            background: #ececec;
            border-radius:50px;
            box-shadow: 0px 0px 1px rgba(0,0,0,0.4);
            -moz-border-radius: 50px;
            -webkit-border-radius: 50px;
        }
        .commentAvatarImage{
            width:50px;
            height:50px;
            line-height: 0;	 /* remove line-height */
            display: inline-block;	/* circle wraps image */
            border-radius: 50%;	/* relative value */
            -moz-border-radius: 50%;
            -webkit-border-radius: 50%;
            transition: linear 0.25s;
        }
    </style>
</head>
<body>

<input type="hidden" id="userId" value="${userId}">
<div class="page-group">
    <div class="page page-current">
        <div class="content">
            <div class="card">
                <div class="card-content">
                    <div class="list-block media-list">
                        <ul>
                            <li class="item-content">
                                <div class="item-media">
                                    <div class="commentAvatarDiv" style="width: 44px;height: 44px">
                                        <img class="commentAvatarImage" src="${request.contextPath}/images/default_head.jpg" style="width: 44px;height: 44px"   >
                                    </div>
                                </div>
                                <div class="item-inner">
                                    <div class="item-title-row">
                                        <div class="item-title"><span id="titleSp"></span></div>
                                    </div>
                                    <div class="item-subtitle content-padded">
                                        <div class="row">
                                            <div class="col-33"><span id="createUserNameSp" ></span></div>
                                            <div class="col-33"><span id="priceSp" ></span>元/次</div>
                                            <div class="col-34"><span id="dateSp" ></span></div>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <form action="${request.contextPath}/order/save" method="post">
                <input type="hidden" id="itemId" name="itemId" value="<#if (order.itemId)??>${order.itemId}<#else>${itemId}</#if>">
                <input type="hidden" id="orderStatus" name="orderStatus" value="BEGIN">
                <input type="hidden" id="optUserType" name="optUserType" value="buyer">
                <div class="list-block cards-list">
                    <ul>
                        <li class="card">
                            <div class="card-header">描述一下您的问题</div>
                            <div class="card-content">
                                <div class="card-content-inner">
                                    <div class="item-input">
                                        <textarea name="orderProblem" id="orderProblem">${order.orderProblem!''}</textarea>
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li class="card">
                            <div class="card-header">简单介绍一下自己</div>
                            <div class="card-content">
                                <div class="card-content-inner">
                                    <div class="item-input">
                                        <textarea name="orderUserDescription" id="orderUserDescription">${order.orderUserDescription!''}</textarea>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </form>

            <div class="content-block">
                <div class="row">
                    <div class="col-50"><a href="#" id="saveOrderBtn" class="button button-big button-fill button-danger">确定</a></div>
                    <div class="col-50"><a href="#" class="button button-big button-fill button-success">取消</a></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type='text/javascript' src='//g.alicdn.com/sj/lib/zepto/zepto.min.js' charset='utf-8'></script>
<script type='text/javascript' src='//g.alicdn.com/msui/sm/0.6.2/js/sm.min.js' charset='utf-8'></script>
<script type='text/javascript' src='//g.alicdn.com/msui/sm/0.6.2/js/sm-extend.min.js' charset='utf-8'></script>
<script>$.init()</script>
<script>
    var orderStatus = '${order.orderStatus}';
    if(orderStatus == 'BEGIN'){
        $('#saveOrderBtn').hide();
    }
    $.showIndicator();
    $.get('${request.contextPath}/item/get-item', {itemId: $('#itemId').val(),userId: $('#userId').val()}, function (response) {
        $('#priceSp').text(response.item.price);
        $('#titleSp').text(response.item.title);
        $('.commentAvatarImage').attr("src",response.userInfo.headImgPath);
        var createDate = response.item.optTime.substring(0,10);
        $('#dateSp').text(createDate);
        $('#createUserNameSp').text(response.userInfo.nickName);
        $.hideIndicator();
    });
    function checkForm(){
        var orderProblem = $('#orderProblem').val();
        var orderUserDescription = $('#orderUserDescription').val();
        if(orderProblem.length < 10 || orderProblem.length > 200){
            $.toast('问题字数为10-200');
            return false;
        }

        if(orderUserDescription.length < 10 || orderUserDescription.length > 200){
            $.toast('介绍字数为10-200');
            return false;
        }
        return true;
    }
    $("#saveOrderBtn").on('click', function () {
        var vali = checkForm();
        if(vali){
            $.showIndicator();
            $('form').submit();
        }
    });
</script>

</body>
</html>