<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>买家约您</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <link rel="stylesheet" href="//g.alicdn.com/msui/sm/0.6.2/css/sm.min.css">
    <link rel="stylesheet" href="//g.alicdn.com/msui/sm/0.6.2/css/sm-extend.min.css">
    <style>
        .commentAvatarDiv{
            width: 50px;
            height: 50px;
            padding:2px;
            background: #ececec;
            border-radius:50px;
            box-shadow: 0px 0px 1px rgba(0,0,0,0.4);
            -moz-border-radius: 50px;
            -webkit-border-radius: 50px;
        }
        .commentAvatarImage{
            width:50px;
            height:50px;
            line-height: 0;	 /* remove line-height */
            display: inline-block;	/* circle wraps image */
            border-radius: 50%;	/* relative value */
            -moz-border-radius: 50%;
            -webkit-border-radius: 50%;
            transition: linear 0.25s;
        }
    </style>
</head>
<body>

<input type="hidden" id="userId" value="${userId}">
<div class="page-group">
    <div class="page page-current">
        <div class="content">
            <div class="card">
                <div class="card-content">
                    <div class="list-block media-list">
                        <ul>
                            <li class="item-content">
                                <div class="item-media">
                                    <div class="commentAvatarDiv" style="width: 44px;height: 44px">
                                        <img class="commentAvatarImage" src="../images/head.jpg" style="width: 44px;height: 44px"   >
                                    </div>
                                </div>
                                <div class="item-inner">
                                    <div class="item-title-row">
                                        <div class="item-title"><span id="titleSp"></span></div>
                                    </div>
                                    <div class="item-subtitle content-padded">
                                        <div class="row">
                                            <div class="col-33"><span id="createUserNameSp" ></span></div>
                                            <div class="col-33"><span id="priceSp" >${order.price}</span>元/次</div>
                                            <div class="col-33"><span id="dateSp" ></span></div>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <form action="${request.contextPath}/order/save" method="post">
                <input type="hidden" id="orderId" name="orderId" value="${order.orderId}">
                <input type="hidden" id="itemId" name="itemId" value="${order.itemId}">
                <input type="hidden" id="orderStatus" name="orderStatus" value="SELLER_APPLY">
                <input type="hidden" id="optUserType" name="optUserType" value="seller">
                <div class="list-block cards-list">
                    <ul>
                        <li class="card">
                            <div class="card-header">买家的问题</div>
                            <div class="card-content">
                                <div class="card-content-inner" id="orderProblem">
                                    ${order.orderProblem}
                                </div>
                            </div>
                        </li>
                        <li class="card">
                            <div class="card-header">买家的自我介绍</div>
                            <div class="card-content">
                                <div class="card-content-inner" id="orderUserDescription">
                                    ${order.orderUserDescription}
                                </div>
                            </div>
                        </li>
                        <li class="card">
                            <div class="card-header"><#if (order.suggestAppointmentTime)??>见面时间为<#else>请填写建议的时间</#if></div>
                            <div class="card-content">
                                <div class="item-input">
                                    <input type="text" name="suggestAppointmentTime" id="suggestAppointmentTime" value="${order.suggestAppointmentTime!''}">
                                </div>
                            </div>
                        </li>
                        <li class="card">
                            <div class="card-header"><#if (order.sellerPhone)??>您填写的手机号为<#else>请填写您的联系手机号(买家付款后可见)</#if></div>
                            <div class="card-content">
                                <div class="item-input">
                                    <input type="text" name="sellerPhone" id="sellerPhone" value="${order.sellerPhone!''}">
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </form>

            <div class="content-block">
                <div class="row">
                    <div class="col-50"><a href="#" id="saveOrderBtn" class="button button-big button-fill button-danger">确定</a></div>
                    <div class="col-50"><a href="#" class="button button-big button-fill button-success">取消</a></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type='text/javascript' src='//g.alicdn.com/sj/lib/zepto/zepto.min.js' charset='utf-8'></script>
<script type='text/javascript' src='//g.alicdn.com/msui/sm/0.6.2/js/sm.min.js' charset='utf-8'></script>
<script type='text/javascript' src='//g.alicdn.com/msui/sm/0.6.2/js/sm-extend.min.js' charset='utf-8'></script>
<script>$.init()</script>
<script>
    var orderStatus = '${order.orderStatus}';
    if(orderStatus == 'SELLER_APPLY'){
        $("#saveOrderBtn").hide();
    }
    $.showIndicator();
    $.get('${request.contextPath}/item/get-item', {itemId: $('#itemId').val(),userId: $('#userId').val()}, function (response) {
        $('#priceSp').text(response.item.price);
        $('#titleSp').text(response.item.title);
        $('.commentAvatarImage').attr("src",response.userInfo.headImgPath);
        var createDate = response.item.optTime.substring(0,10);
        $('#dateSp').text(createDate);
        $('#createUserNameSp').text(response.userInfo.nickName);
        $.hideIndicator();
    });
    function checkForm(){
        var suggestAppointmentTime = $('#suggestAppointmentTime').val();
        var sellerPhone = $('#sellerPhone').val();
        if(suggestAppointmentTime.length == 0){
            $.toast('建议的时间段不能为空');
            return false;
        }

        if(sellerPhone.length < 11 ){
            $.toast('请填写正确的手机号');
            return false;
        }
        return true;
    }
    $("#saveOrderBtn").on('click', function () {

        var vali = checkForm();
        if(vali){
            $.showIndicator();
            $('form').submit();
        }
    });
    var suggestAppointmentTime = "${order.suggestAppointmentTime!''}";
    if(suggestAppointmentTime == ''){
        var date = new Date();
        var month = date.getMonth() + 1;
        var strDate = date.getDate();
        if (month >= 1 && month <= 9) {
            month = "0" + month;
        }
        if (strDate >= 0 && strDate <= 9) {
            strDate = "0" + strDate;
        }
        $("#suggestAppointmentTime").datetimePicker({

            value: [date.getFullYear(), month, strDate, date.getHours(), '00']
        });
    }

</script>

</body>
</html>