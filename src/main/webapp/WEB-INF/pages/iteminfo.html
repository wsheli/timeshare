<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>子项目详情</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <link rel="stylesheet" href="//g.alicdn.com/msui/sm/0.6.2/css/sm.min.css">
    <link rel="stylesheet" href="//g.alicdn.com/msui/sm/0.6.2/css/sm-extend.min.css">
    <link rel="stylesheet" href="${request.contextPath}/css/main.css">
    <style type="text/css">
        .biaoqian{
            display: inline-block;
            width: 54px;
            height: 18px;
            line-height: 18px;
            text-align: center;
            border-radius: 3px;
            font-family: simsun;
            border: 1px solid #ccc;
            color: #ffffff;
            background: #999999;
            font-size: 12px;
        }
    </style>
</head>
<body>
<input type="hidden" id="itemId" value="${itemId}">
<input type="hidden" id="userId" value="${userId}">
<div class="page-group">
    <div class="page page-current">
        <!-- 你的html代码 -->
        <header class="bar bar-nav">
            <a class="icon icon-left pull-left back"></a>
            <h1 class="title">子项目详情</h1>
        </header>
        <div class="content">
            <div style="background: #fff;padding-left: 1rem;padding-right: 1rem" >
                <div class="row">
                    <div class="col-100"><h2 style="color: #666;"><span id="titleSp"></span></h2></div>
                </div>
                <div class="row" >
                    <div class="col-50" ><span id="priceSp"></span>元/次</div>
                    <div class="col-50" >约<span id="durationSp"></span>分钟</div>
                </div>

            </div>
            <div class="content-padded">
                <p><div id="descriptionDiv"></div></p>
            </div>
            <div class="card">
                <div class="card-header"><h4>评价:</h4></div>
                <div class="card-content">
                    <div class="list-block media-list" id="feedbackDiv">

                    </div>
                </div>

            </div>
            <#if selfItem == "yes"><#else>
                <div style="height: 12%">&nbsp;</div>
            </#if>
        </div>

        <#if selfItem == "yes">
            <#if itemStatus == "for_sale">
                <div class="bar bar-standard bar-footer" style="padding-top:0rem;height: 12%">
                    <p><a href="#" id="undercarriageBtn" class="button button-fill button-danger button-big" style="top: -0.1rem;">下架</a></p>
                </div>
            </#if>
        <#else>
            <div class="bar bar-standard bar-footer" style="padding-top:0rem;height: 12%">
                <p><a href="#" id="orderBtn" class="button button-fill button-danger button-big" style="top: -0.1rem;">立即预约</a></p>
            </div>
        </#if>


    </div>
</div>

<script type='text/javascript' src='//g.alicdn.com/sj/lib/zepto/zepto.min.js' charset='utf-8'></script>
<script type='text/javascript' src='//g.alicdn.com/msui/sm/0.6.2/js/sm.min.js' charset='utf-8'></script>
<script type='text/javascript' src='//g.alicdn.com/msui/sm/0.6.2/js/sm-extend.min.js' charset='utf-8'></script>
<script>
    $.showIndicator();

    $("body").on( "click", "#orderBtn", function(){
        var itemId = $('#itemId').val();
        var backUrl = '/order/to-start/'+itemId;
        window.location.href = '${request.contextPath}/wx/to-get-open-id?backUrl='+encodeURIComponent(backUrl);
    } );
    $("body").on( "click", "#undercarriageBtn", function(){
        $.confirm('您确定要下架吗？',
                function () {
                    var itemId = $('#itemId').val();
                    window.location.href = '${request.contextPath}/item/modify-item-status?itemId='+itemId+'&itemStatus=undercarriage';
                }
        );

    } );

    $.get('${request.contextPath}/item/get-item', {itemId: $('#itemId').val(),userId: $('#userId').val()}, function (response) {
        if(response){
            if(response.item.itemType == 'tel'){
                $('#itemTypeSp').text('电话直连');
            }else if(response.itemType == 'meet'){
                $('#itemTypeSp').text('直约面对面');
            }
            $('#priceSp').text(response.item.price);
            //$('#scoreSp').text(response.item.score);
            $('#titleSp').text(response.item.title);
            $('#descriptionDiv').text(response.item.description);
            $('#durationSp').text(response.item.duration);
            //$('#corpSp').text(response.userInfo.corp);
            //$('#nicknameSp').text(response.userInfo.nickName);

            //$('#useCountSp').text('已约'+response.item.useCount+'次');
            //$('#userDesP').text(response.userInfo.description);
            $.hideIndicator();
        }
    });
    $.get('${request.contextPath}/feedback/list-by-item', {itemId: $('#itemId').val()}, function (response) {
        if(response){
            $.each(response, function(i, item){
                var html = '<ul>'+
                        '<li class="item-content">'+
                        '<div class="item-inner">'+
                        '<div class="item-title-row">'+
                        '<div class="item-title">'+item.content+'</div>'+
                        '</div>'+
                        '<div class="item-subtitle">'+item.createUserName+'</div>'+
                        '</div>'+
                        '</li>'+
                        '</ul>';
                $('#feedbackDiv').append(html);
            });

        }
    });
</script>

</body>
</html>

